import org.apache.tools.ant.filters.ReplaceTokens

buildscript {
	repositories {
		gradlePluginPortal()
		maven {
			name = "forge"
			url = "https://maven.minecraftforge.net/"
		}
	}
	dependencies {
		classpath "net.minecraftforge.gradle:ForgeGradle:${project.forgeGradle}"
	}
}

apply plugin: "net.minecraftforge.gradle"

processResources {
	duplicatesStrategy = DuplicatesStrategy.INCLUDE

	from(sourceSets.main.resources.srcDirs) {
		include "mcmod.info"
		filter(ReplaceTokens, tokens: [version: project.version, mcversion: "1.12.2"])
	}
}

dependencies {
	minecraft "net.minecraftforge:forge:${project.minecraft12}"
	implementation project(':toastclient-api')
	implementation("org.spongepowered:mixin:0.7.11-SNAPSHOT") {
		exclude module: 'commons-io'
		exclude module: 'gson'
		exclude module: 'guava'
		exclude module: 'launchwrapper'
		exclude module: 'log4j-core'
	}
	implementation "com.lukflug:panelstudio:0.2.1"
	implementation "com.lukflug:panelstudio-mc12:0.2.0"
}

minecraft {
	mappings("stable", project.mappings12)
}

shadowJar {
	getDestinationDirectory().set(file("$rootDir/out"))

	final String version = parent.version.toString().replaceAll("mcversion", "1.12.2")
	final String archiveName = parent.name + version + '.jar'
	getArchiveFileName().set(archiveName)

	dependencies {
		include(project(':toastclient-api'))
	}
}

build {
	dependsOn(shadowJar)
}
